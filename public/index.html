<!DOCTYPE html>
<html>
<head>
    <title>Key Sender</title>
</head>
<body>
<h2>Press any key in the input box:</h2>
<input type="text" id="inputBox" autofocus />

<br><br>

<label>
    <input type="checkbox" id="randomMouseCheckbox" />
    Random Mouse Movements
</label>

<script>
    const protocol = location.protocol === "https:" ? "wss://" : "ws://";
    const ws = new WebSocket(protocol + location.host);

    ws.onopen = () => console.log("âœ… Connected to server");
    ws.onmessage = (msg) => console.log("ðŸ“¥ Received:", msg.data);

    const input = document.getElementById("inputBox");
    const checkbox = document.getElementById("randomMouseCheckbox");

    input.addEventListener("keyup", (e) => {
        e.preventDefault(); // prevent default behavior

        if (ws.readyState === WebSocket.OPEN) {
            let keys = [];
            console.log(e.key.toUpperCase());
            if (e.ctrlKey) keys.push("CONTROL");
            if (e.altKey) keys.push("ALT");
            if (e.shiftKey) keys.push("SHIFT");
            if (e.metaKey) keys.push("META"); // âŒ˜ on Mac or Win on Windows

            const key = e.key.toUpperCase();

            // Ignore if it's just the modifier
            if (!["CONTROL", "ALT", "SHIFT", "META"].includes(key)) {
                keys.push(key);
            }

            if (keys.length > 0) {
                const payload = {
                    keys: keys
                };
                ws.send(JSON.stringify(payload));
            }
        }
    });

    checkbox.addEventListener("change", () => {
        if (ws.readyState === WebSocket.OPEN) {
            const payload = {
                random_mouse: checkbox.checked
            };
            ws.send(JSON.stringify(payload));
        }
    });
</script>

</body>
</html>
